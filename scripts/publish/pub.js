/** * Created by lzq on 2017/9/7. * pub is a function for publish a version basing on npm */const branch = require('./gitBranch');const shelljs = require('shelljs');const path = require('path');const gitJson = {    branch: 'git symbolic-ref --short -q HEAD'}const currentBranch = branch(gitJson.branch); // beta版本的，在版本号上加一个 -   因此可以通过检测这个 - 来判断是否是稳定版本 从package.json中获得 version（用户自己填写的）/* * param options { *                  REGISTRY: 发布地址 *                  env: 发布的类型  beta or latest *              } * */module.exports = function (baseDir,options) {  // 项目目录 options {REGISTRY, env(beta latest)   }    const packageJson = require(path.join(baseDir, 'package.json'));    const registry = options.REGISTRY;    const env = options.env.toLocaleLowerCase();  // 指明环境 'beta' or 'latest'    process.chdir(path.join(baseDir,'build')); // chdir()方法用来变更当前工作目录为build目录    // 两个思路： 1 利用yargs来通过命令行参数确定    //          2.利用分别两个文件，一个beta 一个latest 不同命令链接到不同的文件夹    if (env === 'beta') {  // beta版本使用在正式版本号后面加 - 来区分   packageJson.includes('-')        // beta version        if(packageJson.version.includes('-')){            console.log(`publishing beta version: ${packageJson.version}`);        }else {            console.log("please checking version lack of '-' ")        }        pubCmd = 'npm publish --' + registry + '--tag beta';        shelljs.exec(pubCmd);    }else if (env === 'latest') {  // latest版本        // stable version        if (currentBranch === 'master') {  // master 分支下            // 可发布 发布到稳定版本            pubCmd = 'npm publish --' + registry;  // npm 默认就是latest下            shelljs.exec(pubCmd);        }else { // 非master环境            console.error('please publish latest version in master');        }    }else{        console.warn('please confirm having a env parameter (beta or latest)');    }    return {currentBranch, env}};