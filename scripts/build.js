/** * Created by lzq on 2017/8/29. */process.env.NODE_ENV = 'production';const ora = require('ora');const fse = require('fs-extra');const path = require('path');const chalk = require('chalk');const webpack = require('webpack');const config = require('../config');const webpackConfig = require('./webpackConfig/webpack.pub.conf.js');const webpackExpConfig = require('./webpackConfig/webpack.buildExp.conf');const prod_fileOperate = require('./fileOperate/prod-fileOperate');const babel_transform = require('./fileOperate/babel-transform');const spinner = ora('package building for production...');spinner.start();const copyFiles = ['yarn.lock', 'README.md'];// 先删除一遍文件  暂时没有改造// const files = fs.readdirSync(path.resolve(__dirname, '../dist'));// files.forEach(function(file){//     if(typeof fs.readdirSync(file) === 'Object'){////     }else{////     }// })console.log('-----------------------------------')console.log(config.build.assetsRoot)console.log('-----------------------------------')// 删除build下的内容fse.emptyDir(path.join(config.build.assetsRoot, ''), err => {   //  rm 第一个参数 path.join(config.scripts.assetsRoot, config.scripts.assetsSubDirectory)    // const filePath = path.join(__dirname,'../../src/index.js');    // const outFilePath = path.join(__dirname,'../../build/index.js');    webpack(webpackConfig, function(error, stats){        spinner.stop();        if (error) throw error;        process.stdout.write(stats.toString({                colors: true,                modules: false,                children: false,                chunks: false,                chunkModules: false            })+ '\n\n');        console.log(chalk.cyan('  Build complete.\n'))        console.log(chalk.yellow(            '  Tip: built files are meant to be served over an HTTP server.\n' +            '  Opening index.html over file:// won\'t work.\n'        ))    });    webpack(webpackExpConfig,function(error, stats){        console.log(chalk.cyan('example build.\n'))    });    copyFiles.forEach(async item => {        await prod_fileOperate.copyFile(item)        console.log('#######')    });    babel_transform.transformFile(config.build.inputIndex, config.build.outputIndex);    prod_fileOperate.createPackageFile(); // 必须在外部rm删除目录后，然后调用});